##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)[1] ) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 4,
height = 6,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]], las = 1, main = ilayer)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longtidue", outer = T)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##############################################
####    Save Output
##############################################
saveRDS(object = covar_stack,
file = paste0(dir, "covar_stack.RDS"))
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)[1] ) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 4,
height = 6,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]], las = 1, main = ilayer)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longtidue", outer = T)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)[1] ) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 6,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]], las = 1, main = ilayer)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longtidue", outer = T)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)[1] ) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 5,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]], las = 1, main = ilayer)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)[1] ) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]], las = 1, main = ilayer)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]], las = 1, main = ilayer)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
names(covar_stack)
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" "Standard Deviation of Sea Surface Height")[ilayer]
)
plot(eez, add = T)
plot(covar_stack_cen[[ilayer]])
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
dev.off()
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" "Standard Deviation of Sea Surface Height")[ilayer]
)
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "Standard Deviation of Sea Surface Height")[ilayer]
)
plot(covar_stack_cen[[ilayer]],
las = 1,
main = paste(c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "Standard Deviation of Sea Surface Height")[ilayer], "- Centered"))
plot(covar_stack_cen[[ilayer]],
las = 1,
main = paste(c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "Standard Deviation of Sea Surface Height")[ilayer], "-- Centered"))
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "Standard Deviation of Sea Surface Height")[ilayer]
)
plot(eez, add = T)
plot(
covar_stack_cen[[ilayer]],
las = 1,
main = paste(
c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "Standard Deviation of Sea Surface Height")[ilayer],
"-- Centered"))
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "StDev of Sea Surface Height")[ilayer]
)
plot(eez, add = T)
plot(
covar_stack_cen[[ilayer]],
las = 1,
main = paste( c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "StDev of Sea Surface Height")[ilayer],
"-- Centered")
)
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,1),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "StDev of Sea Surface Height")[ilayer]
)
plot(eez, add = T)
plot(
covar_stack_cen[[ilayer]],
las = 1,
main = c(
"Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m) -- Centered",
"temp600" = "Temperature (degrees Celcius) at 600m -- Centered",
"chla" = "Chlorophyll (units?) -- Centered",
"sst" = "Sea Surface Temperature (degrees Celcius) -- Centered",
"ssh" = "Sea Surface Height (units?) -- Centered",
"ssh_sd" = "StDev of Sea Surface Height -- Centered")[ilayer]
)
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,2),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "StDev of Sea Surface Height")[ilayer]
)
plot(eez, add = T)
plot(
covar_stack_cen[[ilayer]],
las = 1,
main = c(
"Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m) -- Centered",
"temp600" = "Temperature (degrees Celcius) at 600m -- Centered",
"chla" = "Chlorophyll (units?) -- Centered",
"sst" = "Sea Surface Temperature (degrees Celcius) -- Centered",
"ssh" = "Sea Surface Height (units?) -- Centered",
"ssh_sd" = "StDev of Sea Surface Height -- Centered")[ilayer]
)
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
source('G:/Oyafuso/whales/covariate_stack.R', echo=TRUE)
source('G:/Oyafuso/whales/covariate_stack.R', echo=TRUE)
##################################################
####   Mask stack by two criteria
####   If outside EEZ or shallower than 50 m, remove values
##################################################
covar_stack[bathy_HI > -50] <- covar_stack_cen[bathy_HI > -50] <- NA
covar_stack <- raster::mask(x = covar_stack,
mask = eez)
covar_stack_cen <- raster::mask(x = covar_stack_cen,
mask = eez)
##################################################
####   Plot covariates and centered covariates
##################################################
for (ilayer in names(covar_stack)) {
png(filename = paste0(dir, "covariate_data/", ilayer, ".png"),
width = 5,
height = 7,
units = "in",
res = 500)
par(mfrow = c(2,1),
mar = c(2,3,2,2),
oma = c(2,2,0,0))
plot(covar_stack[[ilayer]],
las = 1,
main = c("Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m)",
"temp600" = "Temperature (degrees Celcius) at 600m",
"chla" = "Chlorophyll (units?)",
"sst" = "Sea Surface Temperature (degrees Celcius)",
"ssh" = "Sea Surface Height (units?)",
"ssh_sd" = "StDev of Sea Surface Height")[ilayer]
)
plot(eez, add = T)
plot(
covar_stack_cen[[ilayer]],
las = 1,
main = c(
"Longitude" = "Longitude",
"Latitude" = "Latitude",
"bath_m" = "Bathymetry (m) -- Centered",
"temp600" = "Temperature (degrees Celcius) at 600m -- Centered",
"chla" = "Chlorophyll (units?) -- Centered",
"sst" = "Sea Surface Temperature (degrees Celcius) -- Centered",
"ssh" = "Sea Surface Height (units?) -- Centered",
"ssh_sd" = "StDev of Sea Surface Height -- Centered")[ilayer]
)
plot(eez, add = T)
mtext(side = 1, text = "Longitude", outer = T, line = 1)
mtext(side = 2, text = "Latitude", outer = T)
dev.off()
}
##############################################
####    Save Output
##############################################
saveRDS(object = covar_stack,
file = paste0(dir, "covar_stack.RDS"))
saveRDS(object = covar_stack_cen,
file = paste0(dir, "covar_stack_cen.RDS"))
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
#Save Output
CV_constraints <- expected_CV(strata = solution$aggr_strata)
creep_rate <- c(0.1, 0.05, 0.05)[isample]
creep_rate
CV_constraints <- CV_constraints * (1 - creep_rate)
#Apply lower threshold: if CV is lower than the threshold, set CV to
#to the lower theshold
for (ispp in 1:ns) {
CV_constraints[ispp] <-
ifelse(CV_constraints[ispp]<threshold[ispp, isample],
threshold[ispp, isample],
CV_constraints[ispp])
}
#Create CV dataframe in the formmat of SamplingStrata
cv <- list()
for (spp in 1:ns) cv[[paste0("CV", spp)]] <- as.numeric(CV_constraints[spp])
cv[["DOM"]] <- 1
cv[["domainvalue"]] <- 1
cv <- as.data.frame(cv)
while (current_n <= 820) { #Run until you reach 820 samples
#Set wd for output files, create a directory if it doesn"t exist yet
temp_dir = paste0(github_dir, "Str", temp_strata, "Run",Run)
if(!dir.exists(temp_dir)) dir.create(temp_dir)
setwd(temp_dir)
#Run optimization
solution <- optimStrata(method = "continuous",
errors = cv,
framesamp = frame,
iter = 300,
pops = 50,
elitism_rate = 0.1,
mut_chance = 1 / (temp_strata + 1),
nStrata = temp_strata,
showPlot = T,
writeFiles = T)
sum_stats <- summaryStrata(solution$framenew,
solution$aggr_strata,
progress=FALSE)
#Plot Solution
goa <- SpatialPointsDataFrame(
coords = Extrapolation_depths[,c("E_km", "N_km")],
data = data.frame(Str_no = solution$framenew$STRATO) )
goa_ras <- raster(goa, resolution = 5)
goa_ras <- rasterize(x = goa, y = goa_ras, field = "Str_no")
png(filename = "solution.png", width = 5, height = 5, units = "in",
res = 500)
plot(goa_ras, axes = F,
col = terrain.colors(temp_strata)[sample(temp_strata)])
dev.off()
#Save Output
CV_constraints <- expected_CV(strata = solution$aggr_strata)
current_n <- sum(sum_stats$Allocation)
isample <- ifelse(current_n < 280, 1, #1 boat
ifelse(current_n < 550, 2, #2 boat
3)) #3 boat
result_list <- list(solution = solution,
sum_stats = sum_stats,
CV_constraints = CV_constraints,
n = current_n)
save(list = "result_list", file = "result_list.RData")
#Set up next run by changing upper CV constraints
#If doing a survey comparison, reduce CV proportionally
#Else: reduce CV absolutely
Run <- Run + 1
creep_rate <- c(0.1, 0.05, 0.05)[isample]
CV_constraints <- CV_constraints * (1 - creep_rate)
#Apply lower threshold: if CV is lower than the threshold, set CV to
#to the lower theshold
for (ispp in 1:ns) {
CV_constraints[ispp] <-
ifelse(CV_constraints[ispp]<threshold[ispp, isample],
threshold[ispp, isample],
CV_constraints[ispp])
}
#Create CV dataframe in the formmat of SamplingStrata
cv <- list()
for (spp in 1:ns) cv[[paste0("CV", spp)]] <- as.numeric(CV_constraints[spp])
cv[["DOM"]] <- 1
cv[["domainvalue"]] <- 1
cv <- as.data.frame(cv)
}
